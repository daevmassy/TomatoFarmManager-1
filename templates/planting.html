{% extends "base.html" %}

{% block title %}Planting - Tomato Farm Management System{% endblock %}

{% block content %}
<h2>üå± Planting Management</h2>

{% if session.get('user_type') == 'admin' %}
<form method="POST" action="/planting/add">
    <div class="form-row">
        <div class="form-group">
            <label for="variety">Tomato Variety *</label>
            <select id="variety" name="variety" required onchange="calculateHarvestDate()">
                <option value="">Select Variety</option>
                <option value="Roma" data-days="75">Roma (75 days)</option>
                <option value="Cherry" data-days="60">Cherry (60 days)</option>
                <option value="Beefsteak" data-days="85">Beefsteak (85 days)</option>
                <option value="Heirloom" data-days="80">Heirloom (80 days)</option>
                <option value="Plum" data-days="70">Plum (70 days)</option>
                <option value="Grape" data-days="65">Grape (65 days)</option>
            </select>
        </div>
        <div class="form-group">
            <label for="planting_date">Planting Date *</label>
            <input type="date" id="planting_date" name="planting_date" required onchange="calculateHarvestDate()">
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <label for="expected_harvest">Expected Harvest Date (Auto-calculated)</label>
            <input type="date" id="expected_harvest" name="expected_harvest" readonly style="background-color: #f0f0f0;">
        </div>
        <div class="form-group">
            <label for="field_location">Field Location</label>
            <select id="field_location" name="field_location">
                <option value="">Select Field</option>
                <option value="Field A">Field A</option>
                <option value="Field B">Field B</option>
                <option value="Field C">Field C</option>
                <option value="Field D">Field D</option>
                <option value="Field E">Field E</option>
                <option value="Nursery 1">Nursery 1</option>
                <option value="Nursery 2">Nursery 2</option>
            </select>
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <label for="quantity">Quantity (plants)</label>
            <input type="number" id="quantity" name="quantity" min="1" value="1">
        </div>
        <div class="form-group">
            <label for="status">Status</label>
            <select id="status" name="status">
                <option value="Planted">Planted</option>
                <option value="Growing">Growing</option>
                <option value="Flowering">Flowering</option>
                <option value="Fruiting">Fruiting</option>
            </select>
        </div>
    </div>
    
    <div class="form-group">
        <label for="notes">Notes</label>
        <textarea id="notes" name="notes" placeholder="Additional notes about this planting..."></textarea>
    </div>
    
    <button type="submit" class="btn">Add Planting Record</button>
</form>
{% else %}
<div style="padding: 20px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 5px; margin-bottom: 20px;">
    <p><strong>‚ÑπÔ∏è Employee Access:</strong> You are viewing in read-only mode. Admin access is required to add or modify planting records.</p>
</div>
{% endif %}

<h2 style="margin-top: 40px;">üìã Planting Records</h2>
<table>
    <thead>
        <tr>
            <th>Variety</th>
            <th>Planting Date</th>
            <th>Expected Harvest</th>
            <th>Location</th>
            <th>Quantity</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for plant in plants %}
        <tr>
            <td>{{ plant.variety }}</td>
            <td>{{ plant.planting_date }}</td>
            <td>{{ plant.expected_harvest_date or 'N/A' }}</td>
            <td>{{ plant.field_location or 'N/A' }}</td>
            <td>{{ plant.quantity }}</td>
            <td>{{ plant.status }}</td>
            <td>
                {% if session.get('user_type') == 'admin' %}
                <form method="POST" action="/planting/delete/{{ plant.id }}" style="display: inline;">
                    <button type="submit" class="btn-delete" onclick="return confirm('Delete this record?')">Delete</button>
                </form>
                {% else %}
                <span style="color: #999;">View Only</span>
                {% endif %}
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="7" style="text-align: center;">No planting records yet</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if total_pages > 1 %}
<div class="pagination">
    {% if page > 1 %}
    <a href="?page={{ page - 1 }}" class="pagination-btn">‚Üê Previous</a>
    {% endif %}
    
    <span class="pagination-info">Page {{ page }} of {{ total_pages }}</span>
    
    {% if page < total_pages %}
    <a href="?page={{ page + 1 }}" class="pagination-btn">Next ‚Üí</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
