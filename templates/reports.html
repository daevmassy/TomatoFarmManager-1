
{% extends "base.html" %}

{% block title %}Reports - Tomato Farm Management System{% endblock %}

{% block content %}
<h2>üìä Farm Reports & Analytics</h2>
<p style="color: #666; margin-bottom: 30px;">View comprehensive reports and analytics for your tomato farm operations.</p>

<div class="reports-grid">
    <!-- Production Summary -->
    <div class="card">
        <h3>üå± Production Summary</h3>
        <div class="report-stats">
            <div class="stat-item">
                <span class="stat-label">Total Plants:</span>
                <span class="stat-value">{{ production.total_plants }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Active Plants:</span>
                <span class="stat-value">{{ production.active_plants }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Total Harvest (kg):</span>
                <span class="stat-value">{{ "%.2f"|format(production.total_harvest) }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Avg Harvest/Plant (kg):</span>
                <span class="stat-value">{{ "%.2f"|format(production.avg_harvest_per_plant) }}</span>
            </div>
        </div>
    </div>

    <!-- Financial Summary -->
    <div class="card">
        <h3>üí∞ Financial Summary</h3>
        <div class="report-stats">
            <div class="stat-item">
                <span class="stat-label">Total Sales:</span>
                <span class="stat-value">${{ "%.2f"|format(financial.total_sales) }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Total Operations Cost:</span>
                <span class="stat-value">${{ "%.2f"|format(financial.total_operations_cost) }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Net Income:</span>
                <span class="stat-value" style="color: {{ 'green' if financial.net_income >= 0 else 'red' }}">
                    ${{ "%.2f"|format(financial.net_income) }}
                </span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Pending Payments:</span>
                <span class="stat-value">${{ "%.2f"|format(financial.pending_payments) }}</span>
            </div>
        </div>
    </div>

    <!-- Harvest by Quality Grade -->
    <div class="card">
        <h3>üèÜ Harvest Quality Distribution</h3>
        <table>
            <thead>
                <tr>
                    <th>Quality Grade</th>
                    <th>Quantity (kg)</th>
                    <th>Percentage</th>
                </tr>
            </thead>
            <tbody>
                {% for grade in quality_distribution %}
                <tr>
                    <td>{{ grade.quality_grade }}</td>
                    <td>{{ "%.2f"|format(grade.total_quantity) }}</td>
                    <td>{{ "%.1f"|format(grade.percentage) }}%</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="3" style="text-align: center;">No harvest data available</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Operations Summary -->
    <div class="card">
        <h3>‚öôÔ∏è Operations Summary</h3>
        <table>
            <thead>
                <tr>
                    <th>Operation Type</th>
                    <th>Count</th>
                    <th>Total Cost</th>
                </tr>
            </thead>
            <tbody>
                {% for op in operations_summary %}
                <tr>
                    <td>{{ op.operation_type }}</td>
                    <td>{{ op.count }}</td>
                    <td>${{ "%.2f"|format(op.total_cost) }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="3" style="text-align: center;">No operations data available</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Field Performance -->
    <div class="card">
        <h3>üìç Field Performance</h3>
        <table>
            <thead>
                <tr>
                    <th>Field Location</th>
                    <th>Plants</th>
                    <th>Harvest (kg)</th>
                </tr>
            </thead>
            <tbody>
                {% for field in field_performance %}
                <tr>
                    <td>{{ field.field_location }}</td>
                    <td>{{ field.plant_count }}</td>
                    <td>{{ "%.2f"|format(field.total_harvest) }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="3" style="text-align: center;">No field data available</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Employee Task Summary -->
    <div class="card">
        <h3>üë∑ Employee Performance</h3>
        <table>
            <thead>
                <tr>
                    <th>Employee</th>
                    <th>Total Tasks</th>
                    <th>Completed</th>
                    <th>In Progress</th>
                    <th>Pending</th>
                </tr>
            </thead>
            <tbody>
                {% for emp in employee_summary %}
                <tr>
                    <td>Employee {{ emp.employee_number }}</td>
                    <td>{{ emp.total_tasks }}</td>
                    <td>{{ emp.completed }}</td>
                    <td>{{ emp.in_progress }}</td>
                    <td>{{ emp.pending }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" style="text-align: center;">No employee task data available</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Monthly Sales Trend -->
    <div class="card">
        <h3>üìà Monthly Sales Trend (Last 6 Months)</h3>
        <table>
            <thead>
                <tr>
                    <th>Month</th>
                    <th>Total Sales</th>
                    <th>Quantity Sold (kg)</th>
                </tr>
            </thead>
            <tbody>
                {% for month in monthly_sales %}
                <tr>
                    <td>{{ month.month }}</td>
                    <td>${{ "%.2f"|format(month.total_sales) }}</td>
                    <td>{{ "%.2f"|format(month.total_quantity) }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="3" style="text-align: center;">No sales data available</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Inventory Status -->
    <div class="card">
        <h3>üì¶ Inventory Status</h3>
        <div class="report-stats">
            <div class="stat-item">
                <span class="stat-label">Total Items:</span>
                <span class="stat-value">{{ inventory.total_items }}</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Low Stock Items:</span>
                <span class="stat-value" style="color: {{ 'red' if inventory.low_stock > 0 else 'green' }}">
                    {{ inventory.low_stock }}
                </span>
            </div>
        </div>
        {% if low_stock_items %}
        <h4 style="margin-top: 15px; color: #d32f2f;">‚ö†Ô∏è Low Stock Alert</h4>
        <table>
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Current</th>
                    <th>Minimum</th>
                </tr>
            </thead>
            <tbody>
                {% for item in low_stock_items %}
                <tr>
                    <td>{{ item.item_name }}</td>
                    <td>{{ item.quantity }} {{ item.unit }}</td>
                    <td>{{ item.min_quantity }} {{ item.unit }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
    </div>
</div>

<style>
.reports-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.report-stats {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.stat-item {
    display: flex;
    justify-content: space-between;
    padding: 10px;
    background: #f5f5f5;
    border-radius: 5px;
}

.stat-label {
    font-weight: bold;
    color: #666;
}

.stat-value {
    font-size: 1.2em;
    font-weight: bold;
    color: #d32f2f;
}

.card h4 {
    margin: 15px 0 10px 0;
}
</style>
{% endblock %}
